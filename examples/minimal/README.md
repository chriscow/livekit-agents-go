# Minimal LiveKit Agent

A fully functional AI greeting agent that demonstrates LiveKit agent capabilities with OpenAI integration and real-time communication.

## Features

- âœ… **LiveKit Room Connection**: Connects to LiveKit rooms and handles participant events
- âœ… **OpenAI Integration**: Generates AI responses using OpenAI's chat completion API
- âœ… **Real-time Messaging**: Publishes messages to room participants via data channel
- âœ… **Event Handling**: Responds to participant join/leave events
- âœ… **Audio/Video Support**: Handles media track subscriptions
- âœ… **Web Client**: Includes browser test client for easy testing

## Quick Setup

### 1. Prerequisites

- Go 1.19 or later
- OpenAI API key (for AI responses)
- LiveKit account (cloud) or local LiveKit server

### 2. Environment Setup

Create a `.env` file or set environment variables:

```bash
# LiveKit Configuration (use either cloud or local)
export LIVEKIT_URL="wss://your-project.livekit.cloud"  # or ws://localhost:7880 for local
export LIVEKIT_API_KEY="your-api-key"
export LIVEKIT_API_SECRET="your-api-secret"

# OpenAI Configuration
export OPENAI_API_KEY="your-openai-api-key"
```

#### For Local Development (Optional)

Start a local LiveKit server:
```bash
docker run --rm -p 7880:7880 -p 7881:7881 -p 7882:7882/udp livekit/livekit-server --dev
```

Then use these local development values:
```bash
export LIVEKIT_URL="ws://localhost:7880"
export LIVEKIT_API_KEY="devkey"
export LIVEKIT_API_SECRET="secret"
```

### 3. Install Dependencies

```bash
cd examples/minimal
go mod tidy
```

### 4. Generate Access Token

Generate a JWT token for the test client:

```bash
go run main.go -generate-token
```

You can customize the token parameters:

```bash
# Generate token for specific room and user
go run main.go -generate-token -room "my-room" -identity "alice" -valid-for 2h

# See all available options
go run main.go --help
```

Copy the generated token for use in the web client.

### 5. Start the Agent

```bash
go run main.go dev
```

You should see output like:
```
2025/06/29 12:45:15 Starting LiveKit Agent: GreetingAgent
2025/06/29 12:45:15 LiveKit Host: your-project.livekit.cloud
2025/06/29 12:45:15 Starting agent in development mode...
2025/06/29 12:45:15 ðŸŽ¯ Participant connected: test-user
2025/06/29 12:45:16 ðŸ“¡ Published greeting to room: Hello there! Welcome to the room!
```

### 6. Test the Agent

#### Method 1: Use the Included Test Client

1. Open `test-client.html` in your web browser
2. Paste the generated token into the text area
3. Click "Connect"
4. Click "Enable Microphone" to join with audio
5. You should see the agent's greeting message appear in the Messages panel

#### Method 2: Use LiveKit's Web Example

Visit: https://example.livekit.io

- Server URL: Your LIVEKIT_URL value
- Token: Use the token generated by `go run main.go -generate-token`

## How It Works

1. **Agent Startup**: The agent connects to LiveKit and waits for room assignments
2. **Participant Detection**: When a participant joins a room, the agent detects the event
3. **AI Response**: The agent uses OpenAI to generate a personalized greeting
4. **Message Publishing**: The greeting is published to the room via LiveKit's data channel
5. **Real-time Delivery**: All participants in the room receive the message instantly

## Code Structure

```
examples/minimal/
â”œâ”€â”€ main.go              # Agent entrypoint, OpenAI integration, and token generation
â”œâ”€â”€ test-client.html     # Browser test client
â””â”€â”€ README.md           # This file

Key Components:
â”œâ”€â”€ LiveKit Room Connection (agents/worker.go)
â”œâ”€â”€ Job Context & Execution (agents/job.go)  
â”œâ”€â”€ Plugin System (plugins/)
â””â”€â”€ Service Interfaces (services/)
```

## Example Agent Interaction

```
[12:45:15] Agent: Connecting to LiveKit room...
[12:45:15] Agent: ðŸŽ¯ Participant connected: test-user
[12:45:16] Agent: Generating greeting with OpenAI...
[12:45:16] Agent: ðŸ“¡ Published greeting to room: Hello there! Welcome to the room!
[12:45:16] Browser: ðŸ¤– Message from agent: Hello there! Welcome to the room!
```

## Configuration Options

The agent can be customized via environment variables:

- `LIVEKIT_URL`: LiveKit server URL
- `LIVEKIT_API_KEY`: LiveKit API key
- `LIVEKIT_API_SECRET`: LiveKit API secret  
- `OPENAI_API_KEY`: OpenAI API key for AI responses
- `LOG_LEVEL`: Logging level (debug, info, warn, error)

## Development Commands

- `go run main.go dev` - Development mode with live reload
- `go run main.go console` - Console mode for testing
- `go run main.go start` - Production deployment mode
- `go run main.go -generate-token` - Generate test tokens

## Troubleshooting

### Common Issues

1. **"identity cannot be empty" error**: Ensure LIVEKIT_API_KEY and LIVEKIT_API_SECRET are set
2. **OpenAI 401 error**: Verify OPENAI_API_KEY is valid and has sufficient credits
3. **Connection timeout**: Check LIVEKIT_URL format (wss:// for cloud, ws:// for local)
4. **Browser client not loading**: Ensure you're serving over HTTP/HTTPS (file:// protocol won't work)

### Debug Mode

Enable debug logging:
```bash
export LOG_LEVEL=debug
go run main.go dev
```

## Next Steps

This minimal example demonstrates core functionality. To extend it:

1. **Add Speech-to-Text**: Process audio input from participants
2. **Add Text-to-Speech**: Generate spoken responses  
3. **Enhanced AI**: More sophisticated conversation handling
4. **Persistent State**: Store conversation history
5. **Custom Actions**: Respond to specific commands or triggers

## Architecture

The agent uses LiveKit's Go SDK and follows these patterns:

- **Plugin-based Services**: Modular STT, TTS, LLM, and VAD services
- **Event-driven Processing**: React to room and participant events
- **Concurrent Job Execution**: Handle multiple rooms simultaneously
- **Graceful Shutdown**: Clean resource management and connection handling